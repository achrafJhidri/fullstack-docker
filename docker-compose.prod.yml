version: "3.8"
services: 
    client:
        build:
            context: ./client
            dockerfile: dockerfile.prod
        restart: unless-stopped
    api:
        build: 
            context: ./api
            dockerfile: dockerfile.prod
        env_file: ./api/.env
        environment: 
            NODE_ENV: production
        restart: unless-stopped
        # depends_on: 
        #     - db
    db:
        image: mongo
        volumes: 
            - type: volume
              source: dbprod
              target: /data/db
        env_file: 
            - ./db/.env
        restart: unless-stopped
    reverse_proxy:
        build:
            context: ./reverse-proxy
            dockerfile: dockerfile.prod
        ports: 
            - 80:80
        restart: unless-stopped
        depends_on: 
            - api
            - db
            - client
volumes: 
    dbprod:
        external: true 



    